import{a4 as u}from"./DIkc0zba.js";import{D as m}from"./CnK0mgqx.js";async function d(r="24h"){try{return(await $fetch(`https://www.polywhaler.com/api/trades?time=${r}&category=all`,{headers:{accept:"application/json"}})).trades.sort((a,o)=>a.timestamp-o.timestamp)}catch(t){return console.error("API Error:",t),{error:t.message}}}async function h(r,t){const a=t.limit||50,o=t.offset||0;try{const n=await $fetch(`https://data-api.polymarket.com/trades?slug=${encodeURIComponent(r)}&limit=${a}&offset=${o}`,{headers:{accept:"application/json"}});return{trades:(Array.isArray(n)?n:n.data||[]).map(e=>({transactionHash:e.transactionHash||e.txid||e.tx||null,icon:e.icon||null,title:e.title||null,timestamp:e.timestamp,outcome:e.outcome||e.prediction||null,price:typeof e.price=="number"?e.price:e.prob||null,size:e.size||e.shares||e.amount||0,side:(e.side||e.action||e.type||"").toUpperCase(),pseudonym:e.pseudonym||e.trader||e.maker||e.address||null,proxyWallet:e.proxyWallet||null,slug:e.slug||r,raw:e}))}}catch(n){return console.error("Failed to fetch trades for market",r,n),u({statusCode:502,statusMessage:"Failed to fetch trades"})}}async function f(r){try{return await $fetch(`https://gamma-api.polymarket.com/events/slug/${r}`,{headers:{accept:"application/json"}})}catch(t){return console.error(`Failed to fetch market for ${r}`,t),{error:`Failed to fetch market for ${r}`,err:t}}}async function g(r){try{const t=((r==null?void 0:r.search)||"").toLowerCase(),a=(r==null?void 0:r.side)||"",o=(r==null?void 0:r.sort)||"recent",n={accept:"application/json","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",referer:"https://polymarket.com",origin:"https://polymarket.com"};let c=await $fetch("https://www.polywhaler.com/api/trades?time=7d&category=all",{headers:n});return c=c.trades.filter(e=>{var l,s;return a&&e.side,!(t&&!((l=e.title)!=null&&l.toLowerCase().includes(t))&&!((s=e.slug)!=null&&s.toLowerCase().includes(t)))}),await Promise.all(c.map(async e=>{var l;try{const s=await $fetch(`https://gamma-api.polymarket.com/events/slug/${e.slug}`,{headers:n});return{id:s.id||e.transaction_hash,icon:s.icon||e.icon,title:s.title||e.title,startDate:s.startDate,endDate:s.endDate,prediction:e.outcome,prob:e.price,tags:((l=s.tags)==null?void 0:l.map(p=>({label:p.label})))||[],impact:s.impact||null,expiry:s.endDate,insider:e.insider||null,type:e.side,amount:s.liquidity,shares:e.size,trader:e.pseudonym,avatarColor:"bg-blue-500",slug:e.slug}}catch(s){return console.error(`Market error: ${e.slug}`,s),{id:e.transaction_hash,icon:e.icon,title:e.title,startDate:e.timestamp,prediction:e.outcome,prob:e.price,tags:[],impact:null,insider:null,type:e.side,amount:e.size,shares:e.size,trader:e.pseudonym,avatarColor:"bg-blue-500",slug:e.slug}}}))}catch(t){return console.error("API Error:",t),{error:t.message}}}async function w(r){try{return await $fetch(`https://www.polywhaler.com/api/whale-profile/${r}?refresh=false`,{headers:{accept:"application/json"}})}catch(t){return console.error("API Error:",t),{error:t.message}}}async function y(r){try{const t=Number(r.limit||10),a=Number(r.offset||0),o=await $fetch("https://www.polywhaler.com/api/trades?time=7d&category=all",{headers:{accept:"application/json"}});return $(o.trades).sort((n,c)=>c.volume-n.volume)}catch(t){return console.error("API Error:",t),{error:t.message}}}function $(r){const t={};return r.forEach(a=>{const o=a.proxyWallet.toLowerCase();t[o]||(t[o]={address:o,trader:a.pseudonym,trades:0,volume:0,lastTrade:a.timestamp,avatarColor:b()}),t[o].trades++,t[o].volume+=a.size*a.price,a.timestamp>t[o].lastTrade&&(t[o].lastTrade=a.timestamp)}),Object.values(t).sort((a,o)=>o.volume-a.volume).map(a=>({...a,volume:A(a.volume),lastTrade:k(a.lastTrade)}))}function b(){const r=["bg-blue-900","bg-purple-900","bg-teal-900","bg-indigo-800","bg-pink-900"];return r[Math.floor(Math.random()*r.length)]}function k(r){const t=Math.floor((new m-new m(r*1e3))/1e3);if(t<60)return`${t}s ago`;const a=Math.floor(t/60);return a<60?`${a}m ago`:`${Math.floor(a/60)}h ago`}function A(r){const t=parseFloat(r);return t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e5?`$${(t/1e3).toFixed(0)}K`:t>=1e3?`$${(t/1e3).toFixed(1)}K`:`$${t.toFixed(0)}`}function v(){return{getLatestTrades:()=>g(),getTrade:i=>f(i),getMarket:i=>h(i),getAllWhales:(i,e)=>y({limit:i,offset:e}),getHistoryStats:i=>d(i),getWhale:i=>w(i)}}export{v as u};
